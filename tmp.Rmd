## add nmf

```{r}
library(NMF)
var_is_numeric <- 
    train_data_1 %>% 
        select(-t,-p,-tsi_real) %>% 
        select_if(is.numeric) %>% 
        names
nmf_start_time <- now()
nmf_model <- 
    nmf(
        x = train_data_1 %>% 
            drop_data_underc %>% 
            select(var_is_numeric) %>% 
            mutate_all(~.+50) %>% 
            as.matrix()
        ,rank = 1
    )
nmf_end_time <- now()
nmf_end_time-nmf_start_time
train_nmf <- 
    predict(nmf_model
            ,newdata = 
              train_data_1 %>% 
              drop_data_underc %>% 
              select(var_is_numeric)
            )[[1]]
test_nmf <- 
    predict(nmf_model
            ,newdata = 
              test_data_1 %>% 
              select(var_is_numeric)
            )[[1]]
```

```{r}
train_nmf2 <- 
    predict(nmf_model
            ,newdata = 
              train_data_1 %>% 
              drop_data_underc %>% 
              select(var_is_numeric)
            )
test_nmf2 <- 
    predict(nmf_model
            ,newdata = 
              test_data_1 %>% 
              select(var_is_numeric)
            )
```


```{r}
predict(nmf_model
    ,newdata = 
      train_data_1 %>% 
      drop_data_underc %>% 
      select(var_is_numeric)
    ) %>% 
    as.data.frame() %>% 
    ggplot(aes(PC1,PC2)) +
    geom_point(alpha=0.05)
```

